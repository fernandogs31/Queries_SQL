SELECT 'Set Transaction Nature Only'
      ,MP.ORGANIZATION_CODE
      ,MSI.SEGMENT1
      ,MSI.DESCRIPTION
      ,MC.CONCATENATED_SEGMENTS Item_NCM
      ,MSI.Global_Attribute2    Transaction_Nature
FROM apps.MTL_SYSTEM_ITEMS_B  MSI
    ,apps.MTL_ITEM_CATEGORIES MIC
    ,apps.MTL_CATEGORY_SETS   MCS
    ,apps.MTL_CATEGORIES_KFV  MC
    ,apps.MTL_PARAMETERS      MP
WHERE MSI.ORGANIZATION_ID  = MIC.ORGANIZATION_ID 
AND  MSI.INVENTORY_ITEM_ID = MIC.INVENTORY_ITEM_ID
AND  MIC.CATEGORY_SET_ID   = MCS.CATEGORY_SET_ID 
AND  MCS.CATEGORY_SET_NAME = 'FISCAL_CLASSIFICATION'
AND  MIC.CATEGORY_ID       = MC.CATEGORY_ID
AND  MCS.STRUCTURE_ID      = MC.STRUCTURE_ID
AND  MSI.ORGANIZATION_ID   = MP.ORGANIZATION_ID
AND  MP.ORGANIZATION_CODE  IN 'U41'
AND  MC.CONCATENATED_SEGMENTS  <> '99999999'
AND  MSI.Global_Attribute2 <> 'FREE OF CHARGE'
AND  MSI.Last_Update_Date > sysdate-720
Union
SELECT 'Set Transaction Nature Only'
      ,MP.ORGANIZATION_CODE
      ,MSI.SEGMENT1
      ,MSI.DESCRIPTION
      ,MC.CONCATENATED_SEGMENTS Item_NCM
      ,MSI.Global_Attribute2    Transaction_Nature
FROM apps.MTL_SYSTEM_ITEMS_B  MSI
    ,apps.MTL_ITEM_CATEGORIES MIC
    ,apps.MTL_CATEGORY_SETS   MCS
    ,apps.MTL_CATEGORIES_KFV  MC
    ,apps.MTL_PARAMETERS      MP
WHERE MSI.ORGANIZATION_ID  = MIC.ORGANIZATION_ID 
AND  MSI.INVENTORY_ITEM_ID = MIC.INVENTORY_ITEM_ID
AND  MIC.CATEGORY_SET_ID   = MCS.CATEGORY_SET_ID 
AND  MCS.CATEGORY_SET_NAME = 'FISCAL_CLASSIFICATION'
AND  MIC.CATEGORY_ID       = MC.CATEGORY_ID
AND  MCS.STRUCTURE_ID      = MC.STRUCTURE_ID
AND  MSI.ORGANIZATION_ID   = MP.ORGANIZATION_ID
AND  MP.ORGANIZATION_CODE  IN ('U41','U42')
AND  MC.CONCATENATED_SEGMENTS  <> '99999999'
AND  MSI.Global_Attribute2 <> 'COMERCIALACAO IMP'
AND  MSI.Last_Update_Date > sysdate-720
Union
SELECT 'Set Transaction NCM and Transaction nature'
      ,MP.ORGANIZATION_CODE
      ,MSI.SEGMENT1
      ,MSI.DESCRIPTION
      ,'' Item_NCM
      ,MSI.Global_Attribute2    Transaction_Nature
FROM apps.MTL_SYSTEM_ITEMS_B  MSI
    ,apps.MTL_PARAMETERS      MP
WHERE Not Exists
  ( SELECT 1
    FROM   APPS.MTL_ITEM_CATEGORIES MIC
          ,APPS.MTL_CATEGORY_SETS   MCS
          ,APPS.MTL_CATEGORIES_KFV  MC
    WHERE MSI.ORGANIZATION_ID  = MIC.ORGANIZATION_ID
      AND  MSI.INVENTORY_ITEM_ID = MIC.INVENTORY_ITEM_ID
      AND  MIC.CATEGORY_SET_ID   = MCS.CATEGORY_SET_ID(+)
      AND  MCS.CATEGORY_SET_NAME = 'FISCAL_CLASSIFICATION'
      AND  MIC.CATEGORY_ID       = MC.CATEGORY_ID
      AND  MCS.STRUCTURE_ID      = MC.STRUCTURE_ID)
AND  MSI.ORGANIZATION_ID   = MP.ORGANIZATION_ID
AND  MP.ORGANIZATION_CODE  = 'U41'
AND  MSI.Global_Attribute2 <> 'FREE OF CHARGE'
AND  MSI.Last_Update_Date > sysdate-720
Union
SELECT 'Set Transaction NCM and Transaction nature'
      ,MP.ORGANIZATION_CODE
      ,MSI.SEGMENT1
      ,MSI.DESCRIPTION
      ,'' Item_NCM
      ,MSI.Global_Attribute2    Transaction_Nature
FROM apps.MTL_SYSTEM_ITEMS_B  MSI
    ,apps.MTL_PARAMETERS      MP
WHERE Not Exists
  ( SELECT 1
    FROM   APPS.MTL_ITEM_CATEGORIES MIC
          ,APPS.MTL_CATEGORY_SETS   MCS
          ,APPS.MTL_CATEGORIES_KFV  MC
    WHERE MSI.ORGANIZATION_ID  = MIC.ORGANIZATION_ID
      AND  MSI.INVENTORY_ITEM_ID = MIC.INVENTORY_ITEM_ID
      AND  MIC.CATEGORY_SET_ID   = MCS.CATEGORY_SET_ID(+)
      AND  MCS.CATEGORY_SET_NAME = 'FISCAL_CLASSIFICATION'
      AND  MIC.CATEGORY_ID       = MC.CATEGORY_ID
      AND  MCS.STRUCTURE_ID      = MC.STRUCTURE_ID)
AND  MSI.ORGANIZATION_ID   = MP.ORGANIZATION_ID
AND  MP.ORGANIZATION_CODE  = 'U42'
AND  MSI.Global_Attribute2 <> 'COMERCIALACAO IMP'
AND  MSI.Last_Update_Date > sysdate-720;
