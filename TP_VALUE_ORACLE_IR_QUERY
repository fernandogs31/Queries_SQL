
SELECT wda.delivery_id, 
       rcta.trx_number, 
       ROUND(RCTLA.EXTENDED_AMOUNT / RCTLA.QUANTITY_ORDERED, 2) UNIT_PRICE  

  FROM   APPS.PO_REQUISITION_LINES_ALL   PRL
       , APPS.PO_REQUISITION_HEADERS_ALL PRH
       , APPS.OE_ORDER_HEADERS_ALL       OOH
       , APPS.OE_ORDER_LINES_ALL         OOL
       , APPS.WSH_DELIVERY_DETAILS       WDD
       , APPS.RCV_SHIPMENT_headers       RSh
       , APPS.RCV_SHIPMENT_LINES         RSL
       , APPS.RA_CUSTOMER_TRX_LINES_ALL  RCTLA
       , APPS.RA_CUSTOMER_TRX_ALL        RCTA
       , apps.wsh_delivery_assignments   wda
       
WHERE 1 = 1
   AND PRL.REQUISITION_LINE_ID = OOL.SOURCE_DOCUMENT_LINE_ID
   AND PRH.REQUISITION_HEADER_ID = PRL.REQUISITION_HEADER_ID
   AND RSL.QUANTITY_SHIPPED = WDD.SHIPPED_QUANTITY
   AND RSL.REQUISITION_LINE_ID = PRL.REQUISITION_LINE_ID
   AND rsl.REQUISITION_LINE_ID = ool.SOURCE_DOCUMENT_LINE_ID 
   AND OOL.HEADER_ID = OOH.HEADER_ID
   AND PRH.REQUISITION_HEADER_ID = OOH.SOURCE_DOCUMENT_ID
   AND WDD.SOURCE_LINE_ID = OOL.LINE_ID
   AND RCTA.CUSTOMER_TRX_ID = RCTLA.CUSTOMER_TRX_ID
   AND OOL.LINE_ID || '' = RCTLA.INTERFACE_LINE_ATTRIBUTE6
   AND rsh.shipment_header_id = rsl.shipment_header_id
   and wda.delivery_detail_id=wdd.delivery_detail_id
   AND wda.delivery_id = 862746493
   AND PRL.REQUISITION_LINE_ID = 67160448
   AND RSL.SHIPMENT_LINE_ID = 231410586
   AND EXISTS (SELECT 1
               FROM APPS.AP_INVOICE_LINES_ALL        AILA,
                    APPS.AP_INVOICES_ALL             AIA,
                    APPS.MTL_INTERCOMPANY_PARAMETERS MIP
               WHERE AIA.INVOICE_ID = AILA.INVOICE_ID
               AND AIA.ORG_ID = 4330 -- Brazil
               AND AILA.REFERENCE_2 = RCTLA.INTERFACE_LINE_ATTRIBUTE7
               AND AIA.REFERENCE_1 = RCTA.CUSTOMER_TRX_ID
               AND AIA.INVOICE_NUM = RCTA.TRX_NUMBER
               AND AIA.ORG_ID = MIP.SELL_ORGANIZATION_ID
               AND AIA.VENDOR_ID = MIP.VENDOR_ID -- This is to ensure better use of Processing Unique Constraint
               AND AILA.REFERENCE_1 || '' = RCTLA.CUSTOMER_TRX_LINE_ID);
